# Claude Code Evaluator - Codebase Reorganization Plan

## Executive Summary

This plan reorganizes the codebase to establish clearer folder structures, fix architectural violations, and break up god objects. The approach combines hierarchical nesting for models/config with clear separation of execution vs scoring responsibilities.

**Primary Goals:**
1. **Fix layering violation**: `experiment/runner.py` imports from CLI layer
2. **Break up god objects**: `DeveloperAgent` (1096 lines) and `EvaluatorAgent` (761 lines)
3. **Clarify module boundaries**: Clear separation between CLI, agents, evaluation, and scoring
4. **Improve organization**: Nested models by domain, nested config loaders

---

## Progress

```
Phase 1: Nest models by domain          [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 2: Nest config loaders            [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 3: Rename core/ â†’ evaluation/     [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 4: Create agents/ top-level       [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 5: Break up DeveloperAgent        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 6: Create scoring/ module         [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 7: Slim down workflows            [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 8: Add sandbox abstraction        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
Phase 9: Final cleanup                  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% âœ… COMPLETED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Overall Progress                        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% (9/9 phases) ðŸŽ‰
```

**Last Updated:** 2026-02-07

---

## Current State

```
src/claude_evaluator/
â”œâ”€â”€ cli/
â”‚   â””â”€â”€ commands/           # Commands contain business logic (PROBLEM)
â”œâ”€â”€ core/                   # Generic name
â”‚   â””â”€â”€ agents/
â”‚       â”œâ”€â”€ developer.py    # 1096 lines - GOD OBJECT
â”‚       â”œâ”€â”€ worker_agent.py
â”‚       â”œâ”€â”€ worker/         # Well-structured
â”‚       â””â”€â”€ evaluator/
â”‚           â””â”€â”€ agent.py    # 761 lines - GOD OBJECT
â”œâ”€â”€ workflows/
â”œâ”€â”€ experiment/
â”‚   â””â”€â”€ runner.py           # Imports CLI commands (ARCHITECTURE VIOLATION)
â”œâ”€â”€ sandbox/
â”œâ”€â”€ report/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ loader.py           # 636 lines - does too much
â”œâ”€â”€ models/                 # Flat structure, confusing names
â”‚   â”œâ”€â”€ experiment.py       # Result models (CONFUSING)
â”‚   â””â”€â”€ experiment_models.py # Config models (CONFUSING)
â””â”€â”€ metrics/
```

---

## Target State

```
src/claude_evaluator/
â”œâ”€â”€ cli/                           # THIN CLI layer
â”‚   â”œâ”€â”€ main.py                    # Dispatcher
â”‚   â”œâ”€â”€ parser.py                  # Argparse setup
â”‚   â”œâ”€â”€ validators.py              # CLI arg validation
â”‚   â”œâ”€â”€ formatters.py              # CLI output formatting
â”‚   â””â”€â”€ commands/                  # Thin wrappers (kept flat)
â”‚       â”œâ”€â”€ base.py
â”‚       â”œâ”€â”€ evaluation.py          # Calls evaluation.executor
â”‚       â”œâ”€â”€ suite.py
â”‚       â”œâ”€â”€ score.py               # Calls scoring.service
â”‚       â””â”€â”€ experiment.py          # Calls experiment.runner
â”‚
â”œâ”€â”€ config/                        # Configuration
â”‚   â”œâ”€â”€ __init__.py                # Re-exports loaders
â”‚   â”œâ”€â”€ loaders/                   # NESTED: Split by what they load
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ suite.py               # Suite YAML parsing
â”‚   â”‚   â”œâ”€â”€ experiment.py          # Experiment YAML parsing
â”‚   â”‚   â””â”€â”€ reviewer.py            # Reviewer config parsing
â”‚   â”œâ”€â”€ models.py                  # Config-specific models
â”‚   â”œâ”€â”€ settings.py                # Pydantic settings
â”‚   â”œâ”€â”€ validators.py              # Field validation
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ models/                        # NESTED: Data models by domain
â”‚   â”œâ”€â”€ __init__.py                # Re-exports all models
â”‚   â”œâ”€â”€ base.py                    # BaseSchema
â”‚   â”œâ”€â”€ enums.py                   # All enums
â”‚   â”‚
â”‚   â”œâ”€â”€ evaluation/                # Evaluation-related models
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ report.py              # EvaluationReport
â”‚   â”‚   â”œâ”€â”€ score_report.py        # ScoreReport, DimensionScore
â”‚   â”‚   â”œâ”€â”€ metrics.py             # AggregatedMetrics
â”‚   â”‚   â””â”€â”€ timeline_event.py      # TimelineEvent
â”‚   â”‚
â”‚   â”œâ”€â”€ execution/                 # Runtime/execution models
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ decision.py            # Decision
â”‚   â”‚   â”œâ”€â”€ tool_invocation.py     # ToolInvocation
â”‚   â”‚   â”œâ”€â”€ progress.py            # Progress
â”‚   â”‚   â””â”€â”€ query_metrics.py       # QueryMetrics
â”‚   â”‚
â”‚   â”œâ”€â”€ interaction/               # Q&A models
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ question.py            # Question
â”‚   â”‚   â””â”€â”€ answer.py              # Answer
â”‚   â”‚
â”‚   â”œâ”€â”€ experiment/                # Experiment models
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py              # ExperimentConfig, JudgeDimension (was experiment_models.py)
â”‚   â”‚   â””â”€â”€ results.py             # RunResult, ExperimentReport (was experiment.py)
â”‚   â”‚
â”‚   â”œâ”€â”€ reviewer.py                # Reviewer output models
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ agents/                        # TOP-LEVEL: Execution agents
â”‚   â”œâ”€â”€ __init__.py                # Re-exports DeveloperAgent, WorkerAgent
â”‚   â”‚
â”‚   â”œâ”€â”€ developer/                 # SPLIT from developer.py
â”‚   â”‚   â”œâ”€â”€ __init__.py            # Re-exports DeveloperAgent
â”‚   â”‚   â”œâ”€â”€ agent.py               # Orchestrator (~300 lines)
â”‚   â”‚   â”œâ”€â”€ state_machine.py       # State transitions
â”‚   â”‚   â”œâ”€â”€ decision_log.py        # Decision tracking
â”‚   â”‚   â””â”€â”€ callbacks.py           # Callback management
â”‚   â”‚
â”‚   â””â”€â”€ worker/                    # MOVED from core/agents/worker/
â”‚       â”œâ”€â”€ __init__.py            # Re-exports WorkerAgent
â”‚       â”œâ”€â”€ agent.py               # Facade (renamed from worker_agent.py)
â”‚       â”œâ”€â”€ tool_tracker.py
â”‚       â”œâ”€â”€ permission_manager.py
â”‚       â”œâ”€â”€ message_processor.py
â”‚       â”œâ”€â”€ question_handler.py
â”‚       â”œâ”€â”€ sdk_config.py
â”‚       â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ scoring/                       # SEPARATE: Scoring/analysis (not an execution agent)
â”‚   â”œâ”€â”€ __init__.py                # Re-exports ScoringService, EvaluatorAgent
â”‚   â”œâ”€â”€ service.py                 # Entry point for scoring operations
â”‚   â”œâ”€â”€ agent.py                   # Reduced orchestrator (~300 lines)
â”‚   â”œâ”€â”€ score_builder.py           # Builds ScoreReport
â”‚   â”œâ”€â”€ claude_client.py           # LLM interaction
â”‚   â”œâ”€â”€ prompts.py
â”‚   â”œâ”€â”€ exceptions.py
â”‚   â”‚
â”‚   â”œâ”€â”€ analyzers/                 # Step, code analysis
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ step_analyzer.py
â”‚   â”‚   â””â”€â”€ code_analyzer.py
â”‚   â”‚
â”‚   â”œâ”€â”€ checks/                    # Static analysis
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ registry.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â”œâ”€â”€ performance.py
â”‚   â”‚   â”œâ”€â”€ best_practices.py
â”‚   â”‚   â””â”€â”€ smells.py
â”‚   â”‚
â”‚   â”œâ”€â”€ reviewers/                 # Multi-phase review
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ registry.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ task_completion.py
â”‚   â”‚   â”œâ”€â”€ error_handling.py
â”‚   â”‚   â””â”€â”€ code_quality.py
â”‚   â”‚
â”‚   â””â”€â”€ ast/                       # AST parsing utilities
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ evaluation/                    # RENAMED from core/ (clearer purpose)
â”‚   â”œâ”€â”€ __init__.py                # Re-exports Evaluation, EvaluationExecutor
â”‚   â”œâ”€â”€ executor.py                # NEW: Evaluation orchestration (from CLI)
â”‚   â”œâ”€â”€ evaluation.py              # Evaluation state container
â”‚   â”œâ”€â”€ state_machine.py           # Generic state machine utilities
â”‚   â”œâ”€â”€ git_operations.py          # Git repository management
â”‚   â”œâ”€â”€ formatters.py              # Question formatting utilities
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ workflows/                     # Execution strategies
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                    # Slimmed (~200 lines)
â”‚   â”œâ”€â”€ direct.py
â”‚   â”œâ”€â”€ plan_then_implement.py
â”‚   â”œâ”€â”€ multi_command.py
â”‚   â”œâ”€â”€ agent_factory.py           # NEW: Agent creation logic
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ experiment/                    # Pairwise experiments
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ runner.py                  # Uses evaluation.executor (NOT cli!)
â”‚   â”œâ”€â”€ judge.py
â”‚   â”œâ”€â”€ statistics.py
â”‚   â”œâ”€â”€ report_generator.py
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ sandbox/                       # Execution isolation
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                    # Abstract interface
â”‚   â”œâ”€â”€ docker.py                  # Docker implementation
â”‚   â””â”€â”€ local.py                   # Passthrough implementation
â”‚
â”œâ”€â”€ report/                        # Report generation
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ generator.py
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ metrics/                       # Metrics collection
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ collector.py
â”‚   â””â”€â”€ exceptions.py
â”‚
â”œâ”€â”€ logging_config.py
â””â”€â”€ exceptions.py                  # Top-level exceptions
```

---

## Architecture Diagrams

### Layered Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRESENTATION LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                              cli/                                        â”‚â”‚
â”‚  â”‚  main.py â”€â”€â†’ parser.py â”€â”€â†’ commands/ (evaluation, suite, score, exp)    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             APPLICATION LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   evaluation/     â”‚  â”‚   experiment/     â”‚  â”‚       workflows/          â”‚â”‚
â”‚  â”‚   executor.py     â”‚  â”‚   runner.py       â”‚  â”‚  direct, plan, multi_cmd  â”‚â”‚
â”‚  â”‚                   â”‚  â”‚   judge.py        â”‚  â”‚  agent_factory.py         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               DOMAIN LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚          agents/              â”‚  â”‚            scoring/                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  service.py, agent.py                 â”‚â”‚
â”‚  â”‚  â”‚developerâ”‚  â”‚   worker   â”‚  â”‚  â”‚  analyzers/, checks/, reviewers/     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚       evaluation/             â”‚  â”‚            report/                    â”‚â”‚
â”‚  â”‚  evaluation.py, state_machine â”‚  â”‚  generator.py                         â”‚â”‚
â”‚  â”‚  git_operations.py            â”‚  â”‚                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            INFRASTRUCTURE LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     sandbox/      â”‚  â”‚     config/       â”‚  â”‚        metrics/           â”‚â”‚
â”‚  â”‚  docker, local    â”‚  â”‚  loaders/         â”‚  â”‚  collector.py             â”‚â”‚
â”‚  â”‚                   â”‚  â”‚  settings.py      â”‚  â”‚                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FOUNDATION LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                             models/                                      â”‚â”‚
â”‚  â”‚   base.py, enums.py                                                      â”‚â”‚
â”‚  â”‚   evaluation/ â”€ execution/ â”€ interaction/ â”€ experiment/                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Module Dependency Diagram

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   cli   â”‚
                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚                    â”‚
                    â–¼                    â–¼                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  evaluation   â”‚    â”‚  experiment â”‚    â”‚    sandbox      â”‚
            â”‚  (executor)   â”‚    â”‚  (runner)   â”‚    â”‚ (docker/local)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                   â”‚
                    â”‚                   â”‚ uses executor
                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (NOT cli!)
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   workflows   â”‚
            â”‚ (strategies)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    agents     â”‚       â”‚    scoring    â”‚
â”‚ developer/    â”‚       â”‚   service     â”‚
â”‚ worker/       â”‚       â”‚   agent       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   â”‚                   â”‚
        â–¼   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  evaluation   â”‚       â”‚    report     â”‚
â”‚ (state, git)  â”‚       â”‚  (generator)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    metrics    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    config     â”‚
            â”‚   loaders/    â”‚
            â”‚   settings    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    models     â”‚â—„â”€â”€â”€ (Foundation: no internal dependencies)
            â”‚ base, enums   â”‚
            â”‚ evaluation/   â”‚
            â”‚ execution/    â”‚
            â”‚ interaction/  â”‚
            â”‚ experiment/   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Import Flow (Allowed Dependencies)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           IMPORT RULES                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  âœ… ALLOWED                           âŒ FORBIDDEN                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                                                               â”‚
â”‚  cli/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ evaluation/         evaluation/ â”€â”€â”€â”€âœ—â”€â”€â”€â†’ cli/             â”‚
â”‚  cli/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ experiment/         experiment/ â”€â”€â”€â”€âœ—â”€â”€â”€â†’ cli/             â”‚
â”‚  cli/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ scoring/            scoring/ â”€â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ cli/             â”‚
â”‚  cli/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ sandbox/            agents/ â”€â”€â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ cli/             â”‚
â”‚                                                                               â”‚
â”‚  evaluation/ â”€â”€â”€â†’ workflows/          workflows/ â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ evaluation/      â”‚
â”‚  evaluation/ â”€â”€â”€â†’ agents/                              (executor)             â”‚
â”‚  evaluation/ â”€â”€â”€â†’ scoring/                                                    â”‚
â”‚                                                                               â”‚
â”‚  experiment/ â”€â”€â”€â†’ evaluation/         experiment/ â”€â”€â”€â”€âœ—â”€â”€â”€â†’ cli/             â”‚
â”‚  experiment/ â”€â”€â”€â†’ scoring/            (CRITICAL FIX)                          â”‚
â”‚                                                                               â”‚
â”‚  workflows/ â”€â”€â”€â”€â†’ agents/             models/ â”€â”€â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ (anything)       â”‚
â”‚  workflows/ â”€â”€â”€â”€â†’ evaluation/         config/ â”€â”€â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ cli/             â”‚
â”‚               (state, not executor)   config/ â”€â”€â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ evaluation/      â”‚
â”‚                                                                               â”‚
â”‚  agents/ â”€â”€â”€â”€â”€â”€â”€â†’ evaluation/                                                 â”‚
â”‚               (state container)                                               â”‚
â”‚  agents/ â”€â”€â”€â”€â”€â”€â”€â†’ models/                                                     â”‚
â”‚  agents/ â”€â”€â”€â”€â”€â”€â”€â†’ config/                                                     â”‚
â”‚                                                                               â”‚
â”‚  scoring/ â”€â”€â”€â”€â”€â”€â†’ models/                                                     â”‚
â”‚  scoring/ â”€â”€â”€â”€â”€â”€â†’ config/                                                     â”‚
â”‚                                                                               â”‚
â”‚  ALL MODULES â”€â”€â”€â†’ models/             models/ â”€â”€â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â†’ (anything)       â”‚
â”‚  ALL MODULES â”€â”€â”€â†’ config/             (except base.py)                        â”‚
â”‚  ALL MODULES â”€â”€â”€â†’ exceptions.py                                               â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Detailed Module Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLI COMMAND FLOW                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User runs: claude-evaluator --suite example.yaml

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ main.py â”‚â”€â”€â”€â”€â–¶â”‚ parser.pyâ”‚â”€â”€â”€â”€â–¶â”‚ commands/suite  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ config/loaders/ â”‚
                                   â”‚   suite.py      â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚ EvaluationSuite
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚   evaluation/   â”‚
                                   â”‚   executor.py   â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                           â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   workflows/    â”‚         â”‚    metrics/     â”‚
                     â”‚   direct.py     â”‚         â”‚   collector.py  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                           â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ agents/developerâ”‚         â”‚  agents/worker  â”‚
       â”‚    agent.py     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    agent.py     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
                â”‚                           â”‚ executes Claude Code
                â–¼                           â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   evaluation/   â”‚         â”‚  Claude Code    â”‚
       â”‚  evaluation.py  â”‚         â”‚     (SDK)       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    scoring/     â”‚
       â”‚   service.py    â”‚â”€â”€â”€â”€â–¶ ScoreReport
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       EXPERIMENT FLOW                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User runs: claude-evaluator --experiment exp.yaml

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ main.py â”‚â”€â”€â”€â”€â–¶â”‚ commands/experiment â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ config/loaders/     â”‚
                  â”‚   experiment.py     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ ExperimentConfig
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   experiment/       â”‚
                  â”‚     runner.py       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
            â–¼                â–¼                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   evaluation/   â”‚ â”‚experiment/â”‚ â”‚   experiment/   â”‚
   â”‚   executor.py   â”‚ â”‚  judge.py â”‚ â”‚  statistics.py  â”‚
   â”‚  (reused!)      â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   scoring/          â”‚
                  â”‚   claude_client.py  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SCORING FLOW                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ scoring/service â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  scoring/agent  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚                â”‚
    â–¼             â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚analyzersâ”‚  â”‚  checks/  â”‚  â”‚  reviewers/ â”‚
â”‚step.py â”‚  â”‚registry.pyâ”‚  â”‚ registry.py â”‚
â”‚code.py â”‚  â”‚security.pyâ”‚  â”‚task_comp.py â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚perform.py â”‚  â”‚error_hand.pyâ”‚
     â”‚      â”‚smells.py  â”‚  â”‚code_qual.py â”‚
     â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ score_builder.pyâ”‚â”€â”€â”€â”€â–¶ ScoreReport
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Internal Module Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          agents/developer/                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚    agent.py     â”‚â—„â”€â”€â”€ Main orchestrator (~300 lines)                      â”‚
â”‚  â”‚  DeveloperAgent â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚           â”‚ uses                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚    â”‚             â”‚                â”‚                                          â”‚
â”‚    â–¼             â–¼                â–¼                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚ â”‚  state_  â”‚ â”‚ decision â”‚ â”‚ callbacks â”‚                                      â”‚
â”‚ â”‚machine.pyâ”‚ â”‚ _log.py  â”‚ â”‚   .py     â”‚                                      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             scoring/                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   service.py    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    agent.py     â”‚â—„â”€â”€â”€ Coordinator (~300 lines)â”‚
â”‚  â”‚ ScoringService  â”‚         â”‚ EvaluatorAgent  â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                       â”‚                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚                  â”‚                  â”‚                   â”‚
â”‚                    â–¼                  â–¼                  â–¼                   â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚             â”‚ analyzers/â”‚      â”‚  checks/  â”‚      â”‚ reviewers/â”‚              â”‚
â”‚             â”‚  base.py  â”‚      â”‚registry.pyâ”‚      â”‚registry.pyâ”‚              â”‚
â”‚             â”‚  step.py  â”‚      â”‚ security  â”‚      â”‚task_comp  â”‚              â”‚
â”‚             â”‚  code.py  â”‚      â”‚  perf     â”‚      â”‚err_handle â”‚              â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  smells   â”‚      â”‚code_qual  â”‚              â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                              â”‚ score_builder.pyâ”‚                             â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              models/                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  â”‚ base.py  â”‚  â”‚ enums.py â”‚â—„â”€â”€â”€ Shared by all                                â”‚
â”‚  â”‚BaseSchemaâ”‚  â”‚WorkflowT â”‚                                                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚ extends                                                              â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚  â”‚  â”‚ evaluation/ â”‚  â”‚ execution/  â”‚  â”‚interaction/ â”‚  â”‚experiment/â”‚ â”‚      â”‚
â”‚  â”‚  â”‚ report.py   â”‚  â”‚ decision.py â”‚  â”‚ question.py â”‚  â”‚ config.py â”‚ â”‚      â”‚
â”‚  â”‚  â”‚ score_rep.pyâ”‚  â”‚ tool_inv.py â”‚  â”‚ answer.py   â”‚  â”‚ results.pyâ”‚ â”‚      â”‚
â”‚  â”‚  â”‚ metrics.py  â”‚  â”‚ progress.py â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚  â”‚  â”‚ timeline.py â”‚  â”‚query_met.py â”‚                                 â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phases Overview

| Phase | Focus | Risk | Tasks |
|-------|-------|------|-------|
| **Phase 1** | Nest models by domain | Medium | 5 tasks |
| **Phase 2** | Nest config loaders | Low | 3 tasks |
| **Phase 3** | Rename core/ to evaluation/ + add executor | Medium | 3 tasks |
| **Phase 4** | Create agents/ top-level, move worker | Medium | 3 tasks |
| **Phase 5** | Break up DeveloperAgent into agents/developer/ | High | 4 tasks |
| **Phase 6** | Create scoring/ module | Medium | 4 tasks |
| **Phase 7** | Slim down workflows | Medium | 3 tasks |
| **Phase 8** | Add sandbox abstraction | Low | 3 tasks |
| **Phase 9** | Final cleanup + update exports | Low | 3 tasks |

**Total**: 31 tasks across 9 phases

---

## Phase 1: Nest Models by Domain (Medium Risk)

**Goal**: Reorganize flat models/ into domain-based subdirectories.

### Task 1.1: Create models/evaluation/ directory

**New directory**: `src/claude_evaluator/models/evaluation/`

**Steps**:
1. Create directory and `__init__.py`
2. Move these files:
   - `models/report.py` â†’ `models/evaluation/report.py`
   - `models/score_report.py` â†’ `models/evaluation/score_report.py`
   - `models/metrics.py` â†’ `models/evaluation/metrics.py`
   - `models/timeline_event.py` â†’ `models/evaluation/timeline_event.py`
3. Update `models/evaluation/__init__.py` to export all models
4. Update all imports across codebase

**Verification**: `ruff check src/ && pytest tests/unit/`

---

### Task 1.2: Create models/execution/ directory

**New directory**: `src/claude_evaluator/models/execution/`

**Steps**:
1. Create directory and `__init__.py`
2. Move these files:
   - `models/decision.py` â†’ `models/execution/decision.py`
   - `models/tool_invocation.py` â†’ `models/execution/tool_invocation.py`
   - `models/progress.py` â†’ `models/execution/progress.py`
   - `models/query_metrics.py` â†’ `models/execution/query_metrics.py`
3. Update `models/execution/__init__.py` to export all models
4. Update all imports across codebase

**Verification**: `ruff check src/ && pytest tests/unit/`

---

### Task 1.3: Create models/interaction/ directory

**New directory**: `src/claude_evaluator/models/interaction/`

**Steps**:
1. Create directory and `__init__.py`
2. Move these files:
   - `models/question.py` â†’ `models/interaction/question.py`
   - `models/answer.py` â†’ `models/interaction/answer.py`
3. Update `models/interaction/__init__.py` to export all models
4. Update all imports across codebase

**Verification**: `ruff check src/ && pytest tests/unit/`

---

### Task 1.4: Create models/experiment/ directory

**New directory**: `src/claude_evaluator/models/experiment/`

**Steps**:
1. Create directory and `__init__.py`
2. Move and rename files:
   - `models/experiment_models.py` â†’ `models/experiment/config.py`
   - `models/experiment.py` â†’ `models/experiment/results.py`
3. Update `models/experiment/__init__.py` to export all models
4. Update all imports across codebase (pay attention to TYPE_CHECKING imports)

**Verification**: `ruff check src/ && pytest tests/unit/`

---

### Task 1.5: Update models/__init__.py with new structure

**File**: `src/claude_evaluator/models/__init__.py`

**Steps**:
1. Update to re-export from all subdirectories
2. Ensure backward compatibility by exporting at top level
3. Define `__all__` explicitly

**Example**:
```python
# models/__init__.py
from claude_evaluator.models.base import BaseSchema
from claude_evaluator.models.enums import WorkflowType, EvaluationStatus, Outcome

# Re-export from subdirectories
from claude_evaluator.models.evaluation import (
    EvaluationReport,
    ScoreReport,
    AggregatedMetrics,
    TimelineEvent,
)
from claude_evaluator.models.execution import (
    Decision,
    ToolInvocation,
    Progress,
    QueryMetrics,
)
from claude_evaluator.models.interaction import Question, Answer
from claude_evaluator.models.experiment import (
    ExperimentConfig,
    RunResult,
    ExperimentReport,
)

__all__ = [
    "BaseSchema",
    "WorkflowType",
    # ... all exports
]
```

**Verification**: `python -c "from claude_evaluator.models import *"` and `pytest tests/`

---

## Phase 2: Nest Config Loaders (Low Risk)

**Goal**: Create config/loaders/ subdirectory for loader modules.

### Task 2.1: Create config/loaders/ directory and split loader.py

**New directory**: `src/claude_evaluator/config/loaders/`

**Steps**:
1. Create directory and `__init__.py`
2. Extract from `config/loader.py`:
   - Suite loading â†’ `config/loaders/suite.py`
   - Experiment loading â†’ `config/loaders/experiment.py`
   - Reviewer loading â†’ `config/loaders/reviewer.py`

**File: config/loaders/suite.py**:
```python
"""Suite configuration loader."""
from pathlib import Path
from claude_evaluator.config.models import EvaluationSuite

def load_suite(path: Path) -> EvaluationSuite:
    """Load and validate an evaluation suite from YAML."""
    ...
```

**File: config/loaders/experiment.py**:
```python
"""Experiment configuration loader."""
from pathlib import Path
from claude_evaluator.models.experiment import ExperimentConfig

def load_experiment(path: Path) -> ExperimentConfig:
    """Load and validate an experiment config from YAML."""
    ...
```

**File: config/loaders/reviewer.py**:
```python
"""Reviewer configuration loader."""
def load_reviewer_config(...):
    ...
```

**Verification**: `ruff check src/config/ && pytest tests/unit/config/`

---

### Task 2.2: Update config/loaders/__init__.py

**File**: `src/claude_evaluator/config/loaders/__init__.py`

**Content**:
```python
"""Configuration loaders."""
from claude_evaluator.config.loaders.suite import load_suite
from claude_evaluator.config.loaders.experiment import load_experiment
from claude_evaluator.config.loaders.reviewer import load_reviewer_config

__all__ = ["load_suite", "load_experiment", "load_reviewer_config"]
```

**Verification**: Imports work

---

### Task 2.3: Update config/__init__.py and clean up old loader.py

**File**: `src/claude_evaluator/config/__init__.py`

**Steps**:
1. Re-export from `config.loaders`
2. Keep backward compatibility
3. Either delete old `loader.py` or keep as re-export shim

**Content**:
```python
"""Configuration module."""
from claude_evaluator.config.loaders import (
    load_suite,
    load_experiment,
    load_reviewer_config,
)
from claude_evaluator.config.settings import Settings, get_settings
from claude_evaluator.config.models import EvaluationSuite, EvaluationConfig

__all__ = [
    "load_suite",
    "load_experiment",
    "load_reviewer_config",
    "Settings",
    "get_settings",
    "EvaluationSuite",
    "EvaluationConfig",
]
```

**Verification**: `pytest tests/` - all config tests pass

---

## Phase 3: Rename core/ to evaluation/ + Add Executor (Medium Risk)

**Goal**: Rename the generic `core/` to descriptive `evaluation/` and extract executor to fix architecture violation.

### Task 3.1: Create evaluation/ directory (rename from core/)

**Steps**:
1. Create `src/claude_evaluator/evaluation/` directory
2. Move these files from `core/`:
   - `core/evaluation.py` â†’ `evaluation/evaluation.py`
   - `core/state_machine.py` â†’ `evaluation/state_machine.py`
   - `core/git_operations.py` â†’ `evaluation/git_operations.py`
   - `core/formatters.py` â†’ `evaluation/formatters.py`
   - `core/exceptions.py` â†’ `evaluation/exceptions.py`
3. Create `evaluation/__init__.py`
4. **DO NOT move `core/agents/` yet** (handled in Phase 4-6)

**Verification**: Moved files compile, no circular imports

---

### Task 3.2: Create evaluation/executor.py

**New file**: `src/claude_evaluator/evaluation/executor.py`

**Purpose**: Contains evaluation execution logic currently in `RunEvaluationCommand.execute()`.

**Extract from `cli/commands/evaluation.py`**:
- Workflow creation logic
- Agent instantiation coordination
- Execution orchestration
- Result handling

**Interface**:
```python
"""Evaluation executor - orchestrates evaluation runs."""
from claude_evaluator.config import Settings, get_settings
from claude_evaluator.models import WorkflowType
from claude_evaluator.config.models import RepositorySource
from claude_evaluator.metrics import MetricsCollector
from claude_evaluator.evaluation.evaluation import Evaluation


class EvaluationExecutor:
    """Executes evaluations by coordinating workflows and agents."""

    def __init__(self, settings: Settings | None = None):
        self.settings = settings or get_settings()

    def execute(
        self,
        task: str,
        workflow_type: WorkflowType,
        repository: RepositorySource | None = None,
        commands: list[str] | None = None,
        metrics_collector: MetricsCollector | None = None,
    ) -> Evaluation:
        """
        Execute an evaluation and return the result.

        Args:
            task: The task description to evaluate
            workflow_type: Type of workflow to use
            repository: Optional repository configuration
            commands: Optional list of commands for multi-command workflow
            metrics_collector: Optional metrics collector

        Returns:
            Completed Evaluation object
        """
        # Create workflow based on type
        workflow = self._create_workflow(workflow_type, metrics_collector)

        # Execute and return result
        return workflow.execute(task, repository, commands)

    def _create_workflow(
        self,
        workflow_type: WorkflowType,
        metrics_collector: MetricsCollector | None,
    ):
        """Create appropriate workflow instance."""
        ...
```

**Verification**: New file compiles, no circular imports

---

### Task 3.3: Refactor CLI commands to use EvaluationExecutor

**Files to update**:
- `cli/commands/evaluation.py`
- `cli/commands/suite.py`
- `experiment/runner.py`

**For cli/commands/evaluation.py**:
```python
# Before
class RunEvaluationCommand(BaseCommand):
    def execute(self, args):
        # 200+ lines of orchestration

# After
class RunEvaluationCommand(BaseCommand):
    def execute(self, args):
        executor = EvaluationExecutor(self.settings)
        evaluation = executor.execute(
            task=args.task,
            workflow_type=args.workflow,
            repository=self._build_repository(args),
        )
        self._output_result(evaluation)
```

**For experiment/runner.py** (CRITICAL - fixes architecture violation):
```python
# Before (WRONG)
from claude_evaluator.cli.commands.evaluation import RunEvaluationCommand

# After (CORRECT)
from claude_evaluator.evaluation import EvaluationExecutor
```

**Verification**: `pytest tests/e2e/ && pytest tests/integration/`

---

## Phase 4: Create agents/ Top-Level and Move Worker (Medium Risk)

**Goal**: Promote agents to top-level, move worker module.

### Task 4.1: Create agents/ directory structure

**New directory**: `src/claude_evaluator/agents/`

**Steps**:
1. Create `src/claude_evaluator/agents/` directory
2. Create `agents/__init__.py`

**Initial content of agents/__init__.py**:
```python
"""Execution agents for Claude Code evaluation."""
# Will be populated as we move modules

__all__ = []
```

**Verification**: Directory exists

---

### Task 4.2: Move worker module to agents/worker/

**Current**: `src/claude_evaluator/core/agents/worker/`
**Target**: `src/claude_evaluator/agents/worker/`

**Steps**:
1. Move entire `worker/` directory to `agents/worker/`
2. Move `core/agents/worker_agent.py` to `agents/worker/agent.py`
3. Update `agents/worker/__init__.py`:
   ```python
   """Worker agent module."""
   from claude_evaluator.agents.worker.agent import WorkerAgent

   __all__ = ["WorkerAgent"]
   ```
4. Update all imports across codebase:
   - `core/__init__.py`
   - `workflows/base.py`
   - Any test files

**Verification**: `ruff check src/ && pytest tests/`

---

### Task 4.3: Update agents/__init__.py with worker export

**File**: `src/claude_evaluator/agents/__init__.py`

**Content**:
```python
"""Execution agents for Claude Code evaluation."""
from claude_evaluator.agents.worker import WorkerAgent

__all__ = ["WorkerAgent"]
```

**Verification**: `python -c "from claude_evaluator.agents import WorkerAgent"`

---

## Phase 5: Break Up DeveloperAgent (High Risk)

**Goal**: Split the 1096-line DeveloperAgent into focused modules under agents/developer/.

### Task 5.1: Create agents/developer/ directory structure

**New directory**: `src/claude_evaluator/agents/developer/`

**Steps**:
1. Create directory
2. Analyze current `core/agents/developer.py` to identify sections:
   - State machine logic (~150 lines)
   - Decision logging (~100 lines)
   - Callback management (~100 lines)
   - SDK interaction (~200 lines)
   - Question handling coordination (~150 lines)
   - Core orchestration (~300 lines)

**Verification**: Directory exists

---

### Task 5.2: Extract agents/developer/state_machine.py

**New file**: `src/claude_evaluator/agents/developer/state_machine.py`

**Extract from `core/agents/developer.py`**:
- State enum (if not already in models/enums.py)
- State transition logic
- State validation
- State change callbacks

**Interface**:
```python
"""Developer agent state machine."""
from claude_evaluator.models import DeveloperState  # or define here


class DeveloperStateMachine:
    """Manages state transitions for the developer agent."""

    def __init__(self, initial_state: DeveloperState = DeveloperState.INITIALIZING):
        self._state = initial_state
        self._state_history: list[DeveloperState] = [initial_state]

    @property
    def state(self) -> DeveloperState:
        """Current state."""
        return self._state

    @property
    def history(self) -> list[DeveloperState]:
        """State transition history."""
        return self._state_history.copy()

    def transition_to(self, new_state: DeveloperState) -> None:
        """
        Validate and perform state transition.

        Raises:
            InvalidStateTransitionError: If transition is not allowed.
        """
        if not self.can_transition_to(new_state):
            raise InvalidStateTransitionError(
                f"Cannot transition from {self._state} to {new_state}"
            )
        self._state = new_state
        self._state_history.append(new_state)

    def can_transition_to(self, new_state: DeveloperState) -> bool:
        """Check if transition to new_state is valid."""
        valid_transitions = self._get_valid_transitions()
        return new_state in valid_transitions.get(self._state, set())

    def _get_valid_transitions(self) -> dict[DeveloperState, set[DeveloperState]]:
        """Define valid state transitions."""
        ...
```

**Verification**: Unit tests for state machine

---

### Task 5.3: Extract agents/developer/decision_log.py

**New file**: `src/claude_evaluator/agents/developer/decision_log.py`

**Extract from `core/agents/developer.py`**:
- Decision tracking
- Decision serialization
- Decision history management

**Interface**:
```python
"""Decision logging for developer agent."""
from claude_evaluator.models.execution import Decision


class DecisionLog:
    """Tracks decisions made during agent execution."""

    def __init__(self):
        self._decisions: list[Decision] = []

    def record(self, decision: Decision) -> None:
        """Record a decision."""
        self._decisions.append(decision)

    def get_all(self) -> list[Decision]:
        """Get all recorded decisions."""
        return self._decisions.copy()

    def get_by_type(self, decision_type: str) -> list[Decision]:
        """Get decisions filtered by type."""
        return [d for d in self._decisions if d.type == decision_type]

    def to_dict(self) -> list[dict]:
        """Serialize all decisions to dict format."""
        return [d.model_dump() for d in self._decisions]

    def clear(self) -> None:
        """Clear all decisions."""
        self._decisions.clear()
```

**Verification**: Unit tests for decision logging

---

### Task 5.4: Create agents/developer/agent.py (refactored from original)

**File**: `src/claude_evaluator/agents/developer/agent.py`

**Target**: ~300 lines (down from 1096)

**Steps**:
1. Copy `core/agents/developer.py` to `agents/developer/agent.py`
2. Remove code extracted to:
   - `state_machine.py` â†’ use `DeveloperStateMachine`
   - `decision_log.py` â†’ use `DecisionLog`
3. Agent should now:
   - Initialize components (state machine, decision log)
   - Coordinate SDK interaction
   - Orchestrate question handling
   - Delegate state/decisions to extracted classes
4. Update `agents/developer/__init__.py`:
   ```python
   """Developer agent module."""
   from claude_evaluator.agents.developer.agent import DeveloperAgent
   from claude_evaluator.agents.developer.state_machine import DeveloperStateMachine
   from claude_evaluator.agents.developer.decision_log import DecisionLog

   __all__ = ["DeveloperAgent", "DeveloperStateMachine", "DecisionLog"]
   ```
5. Update `agents/__init__.py` to export `DeveloperAgent`
6. Update all imports across codebase

**Verification**: `pytest tests/integration/test_agent_communication.py`

---

## Phase 6: Create scoring/ Module (Medium Risk)

**Goal**: Move evaluator from core/agents/evaluator/ to top-level scoring/ and break up the god object.

### Task 6.1: Create scoring/ directory structure

**New directory**: `src/claude_evaluator/scoring/`

**Steps**:
1. Create `src/claude_evaluator/scoring/` directory
2. Create `scoring/__init__.py`
3. Move these from `core/agents/evaluator/`:
   - `analyzers/` â†’ `scoring/analyzers/`
   - `checks/` â†’ `scoring/checks/`
   - `reviewers/` â†’ `scoring/reviewers/`
   - `ast/` â†’ `scoring/ast/`
   - `claude_client.py` â†’ `scoring/claude_client.py`
   - `prompts.py` â†’ `scoring/prompts.py`
   - `exceptions.py` â†’ `scoring/exceptions.py`

**DO NOT move yet**: `agent.py` (will be split in next tasks)

**Verification**: Imports resolve, `ruff check src/scoring/`

---

### Task 6.2: Create scoring/score_builder.py

**New file**: `src/claude_evaluator/scoring/score_builder.py`

**Purpose**: Extract ScoreReport building logic from EvaluatorAgent.

**Extract from `core/agents/evaluator/agent.py`**:
- `_build_score_report()` method and related helpers
- `_calculate_final_score()` logic
- `_aggregate_dimension_scores()` logic
- Result assembly code

**Interface**:
```python
"""Score report builder."""
from claude_evaluator.models.evaluation import ScoreReport


class ScoreReportBuilder:
    """Builds ScoreReport from analysis results."""

    def build(
        self,
        analyzer_results: dict,
        check_results: dict,
        reviewer_results: dict,
        evaluation_context: dict,
    ) -> ScoreReport:
        """
        Build a complete ScoreReport from analysis results.

        Args:
            analyzer_results: Results from code/step analyzers
            check_results: Results from static analysis checks
            reviewer_results: Results from multi-phase reviewers
            evaluation_context: Additional context about the evaluation

        Returns:
            Complete ScoreReport with all dimensions scored
        """
        ...

    def _calculate_final_score(self, dimension_scores: dict) -> float:
        """Calculate weighted final score."""
        ...

    def _aggregate_dimension_scores(self, results: dict) -> dict:
        """Aggregate scores per dimension."""
        ...
```

**Verification**: Unit tests for score building

---

### Task 6.3: Create scoring/service.py

**New file**: `src/claude_evaluator/scoring/service.py`

**Purpose**: High-level entry point for scoring operations.

**Interface**:
```python
"""Scoring service - entry point for scoring operations."""
from pathlib import Path

from claude_evaluator.config import Settings, get_settings
from claude_evaluator.models.evaluation import ScoreReport
from claude_evaluator.evaluation.evaluation import Evaluation


class ScoringService:
    """High-level service for scoring evaluations."""

    def __init__(self, settings: Settings | None = None):
        self.settings = settings or get_settings()
        self._agent = None  # Lazy initialization

    def score_evaluation_file(self, evaluation_path: Path) -> ScoreReport:
        """
        Score an evaluation from a JSON file.

        Args:
            evaluation_path: Path to evaluation.json file

        Returns:
            ScoreReport with detailed scoring
        """
        ...

    def score_evaluation(self, evaluation: Evaluation) -> ScoreReport:
        """
        Score an Evaluation object directly.

        Args:
            evaluation: Completed Evaluation object

        Returns:
            ScoreReport with detailed scoring
        """
        ...
```

**Update cli/commands/score.py** to use this service.

**Verification**: `pytest tests/` - scoring tests pass

---

### Task 6.4: Refactor scoring/agent.py (reduce from 761 lines)

**File**: `src/claude_evaluator/scoring/agent.py`

**Steps**:
1. Move `core/agents/evaluator/agent.py` to `scoring/agent.py`
2. Remove code extracted to `score_builder.py`
3. Agent should only:
   - Coordinate analyzers
   - Coordinate check registry
   - Coordinate reviewer registry
   - Delegate score building to `ScoreReportBuilder`
4. Target: ~300 lines

**Update scoring/__init__.py**:
```python
"""Scoring module for evaluation analysis."""
from claude_evaluator.scoring.service import ScoringService
from claude_evaluator.scoring.agent import EvaluatorAgent

__all__ = ["ScoringService", "EvaluatorAgent"]
```

**Verification**: `pytest tests/unit/evaluator/`

---

## Phase 7: Slim Down Workflows (Medium Risk)

**Goal**: Reduce BaseWorkflow from 572 lines by extracting agent factory.

### Task 7.1: Create workflows/agent_factory.py

**New file**: `src/claude_evaluator/workflows/agent_factory.py`

**Extract from `workflows/base.py`**:
- Agent instantiation logic
- Agent configuration
- Permission setup

**Interface**:
```python
"""Agent factory for workflow execution."""
from claude_evaluator.config import Settings
from claude_evaluator.agents import WorkerAgent, DeveloperAgent


class AgentFactory:
    """Creates and configures agents for workflow execution."""

    def __init__(self, settings: Settings):
        self.settings = settings

    def create_worker_agent(
        self,
        working_directory: str | None = None,
        permission_mode: str = "auto",
        **kwargs,
    ) -> WorkerAgent:
        """
        Create a configured WorkerAgent.

        Args:
            working_directory: Directory for agent execution
            permission_mode: Permission handling mode
            **kwargs: Additional agent configuration

        Returns:
            Configured WorkerAgent instance
        """
        ...

    def create_developer_agent(
        self,
        worker_agent: WorkerAgent,
        **kwargs,
    ) -> DeveloperAgent:
        """
        Create a configured DeveloperAgent.

        Args:
            worker_agent: Associated WorkerAgent
            **kwargs: Additional agent configuration

        Returns:
            Configured DeveloperAgent instance
        """
        ...
```

**Verification**: Agent creation works through factory

---

### Task 7.2: Extract workflows/question_handler.py

**New file**: `src/claude_evaluator/workflows/question_handler.py`

**Extract from `workflows/base.py`**:
- Question handling setup
- Question callback configuration
- Answer processing

**Interface**:
```python
"""Question handling for workflows."""
from claude_evaluator.agents import DeveloperAgent
from claude_evaluator.models.interaction import Answer


class WorkflowQuestionHandler:
    """Handles questions during workflow execution."""

    def __init__(self, auto_answer: bool = True):
        self.auto_answer = auto_answer
        self._pending_questions = []

    def setup_callbacks(self, developer: DeveloperAgent) -> None:
        """Configure question callbacks on developer agent."""
        ...

    def process_answer(self, answer: Answer) -> None:
        """Process an answer to a pending question."""
        ...
```

**Verification**: Question handling works

---

### Task 7.3: Refactor workflows/base.py (reduce from 572 lines)

**Target**: ~200 lines

**Steps**:
1. Import and use `AgentFactory`
2. Import and use `WorkflowQuestionHandler`
3. BaseWorkflow should only:
   - Define workflow interface
   - Coordinate high-level execution flow
   - Delegate agent creation and question handling

**Update workflows/__init__.py**:
```python
"""Workflow implementations."""
from claude_evaluator.workflows.base import BaseWorkflow
from claude_evaluator.workflows.direct import DirectWorkflow
from claude_evaluator.workflows.plan_then_implement import PlanThenImplementWorkflow
from claude_evaluator.workflows.multi_command import MultiCommandWorkflow
from claude_evaluator.workflows.agent_factory import AgentFactory

__all__ = [
    "BaseWorkflow",
    "DirectWorkflow",
    "PlanThenImplementWorkflow",
    "MultiCommandWorkflow",
    "AgentFactory",
]
```

**Verification**: `pytest tests/e2e/` - all workflow tests pass

---

## Phase 8: Add Sandbox Abstraction (Low Risk)

**Goal**: Create a proper abstraction for sandbox execution.

### Task 8.1: Create sandbox/base.py

**New file**: `src/claude_evaluator/sandbox/base.py`

**Interface**:
```python
"""Base sandbox interface."""
from abc import ABC, abstractmethod


class BaseSandbox(ABC):
    """Abstract base class for execution sandboxes."""

    @abstractmethod
    def execute(self, args: list[str]) -> int:
        """
        Execute CLI command in sandbox.

        Args:
            args: Command-line arguments to execute

        Returns:
            Exit code from execution
        """
        ...

    @abstractmethod
    def is_available(self) -> bool:
        """Check if this sandbox type is available."""
        ...

    @property
    @abstractmethod
    def name(self) -> str:
        """Human-readable sandbox name."""
        ...
```

**Verification**: Abstract class compiles

---

### Task 8.2: Refactor sandbox/docker.py

**Current**: `src/claude_evaluator/sandbox/docker_sandbox.py`
**Target**: `src/claude_evaluator/sandbox/docker.py`

**Steps**:
1. Rename file
2. Make `DockerSandbox` extend `BaseSandbox`
3. Implement abstract methods
4. Update imports in `cli/main.py`

**Verification**: Docker sandbox still works

---

### Task 8.3: Create sandbox/local.py and update __init__.py

**New file**: `src/claude_evaluator/sandbox/local.py`

**Purpose**: Explicit "no sandbox" implementation for clarity.

```python
"""Local (passthrough) sandbox."""
import subprocess

from claude_evaluator.sandbox.base import BaseSandbox


class LocalSandbox(BaseSandbox):
    """Passthrough sandbox that runs commands locally without isolation."""

    def execute(self, args: list[str]) -> int:
        """Execute command directly in local environment."""
        result = subprocess.run(args)
        return result.returncode

    def is_available(self) -> bool:
        """Local sandbox is always available."""
        return True

    @property
    def name(self) -> str:
        return "local"
```

**Update sandbox/__init__.py**:
```python
"""Execution sandboxes."""
from claude_evaluator.sandbox.base import BaseSandbox
from claude_evaluator.sandbox.docker import DockerSandbox
from claude_evaluator.sandbox.local import LocalSandbox

__all__ = ["BaseSandbox", "DockerSandbox", "LocalSandbox"]
```

**Verification**: Both sandbox types work

---

## Phase 9: Final Cleanup (Low Risk)

**Goal**: Clean up old directories, update exports, verify everything works.

### Task 9.1: Remove old core/agents/ directory

**Steps**:
1. Verify all code has been moved:
   - `core/agents/developer.py` â†’ `agents/developer/`
   - `core/agents/worker_agent.py` â†’ `agents/worker/agent.py`
   - `core/agents/worker/` â†’ `agents/worker/`
   - `core/agents/evaluator/` â†’ `scoring/`
2. Delete `core/agents/` directory entirely
3. Delete empty `core/` directory if all contents moved

**Verification**: No references to old paths remain

---

### Task 9.2: Update all __init__.py exports

**Files to verify/update**:
- `src/claude_evaluator/__init__.py`
- `src/claude_evaluator/agents/__init__.py`
- `src/claude_evaluator/scoring/__init__.py`
- `src/claude_evaluator/evaluation/__init__.py`
- `src/claude_evaluator/workflows/__init__.py`
- `src/claude_evaluator/config/__init__.py`
- `src/claude_evaluator/models/__init__.py`
- `src/claude_evaluator/sandbox/__init__.py`

**Ensure**:
- Public API is clearly exported
- `__all__` is defined in each module
- Backward compatibility via re-exports where needed

**Verification**: `python -c "from claude_evaluator import ..."`

---

### Task 9.3: Update CLAUDE.md and run full test suite

**Update CLAUDE.md** with new structure:
```markdown
## Project Structure

src/claude_evaluator/
  cli/              # CLI entry point, parser, commands
  config/           # Settings, YAML loaders (config/loaders/)
  models/           # Pydantic models (evaluation/, execution/, interaction/, experiment/)
  agents/           # Execution agents (developer/, worker/)
  scoring/          # Scoring and analysis (analyzers/, checks/, reviewers/)
  evaluation/       # Evaluation orchestration and state
  workflows/        # Workflow strategies (direct, plan, multi_command)
  experiment/       # Pairwise experiment system
  sandbox/          # Docker/local execution isolation
  report/           # Report generation
  metrics/          # Token/cost metrics collection
```

**Run full test suite**:
```bash
ruff check src/
ruff format --check src/
pytest tests/unit/ -v
pytest tests/integration/ -v
pytest tests/e2e/ -v
```

**Verification**: All tests pass, no lint errors

---

## Dependency Flow (Final)

```
cli/commands/
      â”‚
      â”œâ”€â”€â†’ evaluation/executor â”€â”€â†’ workflows/ â”€â”€â†’ agents/developer, agents/worker
      â”‚         â”‚
      â”‚         â””â”€â”€â†’ scoring/service â”€â”€â†’ scoring/agent
      â”‚
      â”œâ”€â”€â†’ experiment/runner â”€â”€â†’ evaluation/executor (NOT cli!)
      â”‚         â”‚
      â”‚         â””â”€â”€â†’ experiment/judge â”€â”€â†’ scoring/claude_client
      â”‚
      â””â”€â”€â†’ sandbox/ (intercepts before executor)

models/ â†â”€â”€ (used by all, depends on nothing)
config/ â†â”€â”€ (used by all, depends on models only)
```

---

## Verification Checklist

After completing all phases:

- [ ] `ruff check src/` passes
- [ ] `ruff format --check src/` passes
- [ ] `pytest tests/unit/` passes
- [ ] `pytest tests/integration/` passes
- [ ] `pytest tests/e2e/` passes
- [ ] `claude-evaluator --help` works
- [ ] No circular imports (`python -c "import claude_evaluator"`)
- [ ] `experiment/runner.py` does NOT import from `cli/`
- [ ] All `__init__.py` files have `__all__` defined
- [ ] CLAUDE.md updated with new structure

---

## Rollback Strategy

If issues arise during any phase:

1. **Git branches**: Create a branch for each phase (`refactor/phase-1-models`, etc.)
2. **Incremental commits**: Commit after each task
3. **Test after each task**: Don't proceed if tests fail
4. **Revert if needed**: `git revert` specific commits

---

## Summary

| Phase | Tasks | Key Changes |
|-------|-------|-------------|
| 1 | 5 | Nest models into evaluation/, execution/, interaction/, experiment/ |
| 2 | 3 | Create config/loaders/ with split loader modules |
| 3 | 3 | Rename core/ â†’ evaluation/, add executor.py |
| 4 | 3 | Create agents/ top-level, move worker |
| 5 | 4 | Break up DeveloperAgent (1096 â†’ ~300 lines) |
| 6 | 4 | Create scoring/ module, break up EvaluatorAgent |
| 7 | 3 | Slim workflows, extract agent_factory |
| 8 | 3 | Add sandbox abstraction |
| 9 | 3 | Final cleanup |

**Total**: 31 tasks across 9 phases
